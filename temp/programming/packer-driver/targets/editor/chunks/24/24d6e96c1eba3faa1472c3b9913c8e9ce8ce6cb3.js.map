{"version":3,"sources":["file:///Users/dengyaqi/Desktop/CocosProject/cocos-plane-war-master/assets/Scripts/game/PlayerCtrl.ts"],"names":["_decorator","Component","Node","UITransform","v3","Prefab","instantiate","PhysicsSystem2D","Contact2DType","resources","SpriteFrame","Sprite","find","BackgroundCtrl","BulletCtrl","EnemyCtrl","ccclass","property","PlayerCtrl","type","onLoad","instance","on","BEGIN_CONTACT","onBeginContact","selfCollider","otherCollider","contact","tag","getComponent","miss","die","isDestory","pause","vectory","lose","start","uiTrans","node","EventType","TOUCH_MOVE","touch","setWorldPosition","getUILocation","x","y","schedule","aNumber","Math","random","xPos","floor","symbol","enemy","enemyPrefab","setParent","parent","setPosition","bullet","bulletPrefab","getPosition","update","deltaTime","unscheduleAllCallbacks","load","err","data","spriteFrame","onDestroy","destroy"],"mappings":"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","sourcesContent":["import { BackgroundCtrl } from \"./BackgroundCtrl\";\nimport { BulletCtrl } from \"./BulletCtrl\";\nimport { EnemyCtrl } from \"./EnemyCtrl\";\nimport {\n  _decorator,\n  Component,\n  Node,\n  EventTouch,\n  UITransform,\n  v3,\n  Prefab,\n  instantiate,\n  PhysicsSystem2D,\n  Contact2DType,\n  Collider2D,\n  IPhysics2DContact,\n  resources,\n  SpriteFrame,\n  Sprite,\n  director,\n  find,\n} from \"cc\";\nconst { ccclass, property } = _decorator;\n\n// 飞机模型\n@ccclass(\"PlayerCtrl\")\nexport class PlayerCtrl extends Component {\n  @property({ type: Prefab })\n  private bulletPrefab: Prefab = null;\n\n  @property({ type: Prefab })\n  private enemyPrefab: Prefab = null;\n\n  onLoad() {\n    // 注册全局碰撞回调函数\n    PhysicsSystem2D.instance?.on(\n      Contact2DType.BEGIN_CONTACT,\n      this.onBeginContact,\n      this\n    );\n  }\n\n  onBeginContact(\n    selfCollider: Collider2D,\n    otherCollider: Collider2D,\n    contact: IPhysics2DContact | null\n  ) {\n    // 子弹和敌人碰撞\n    if (\n      (selfCollider.tag === 0 && otherCollider.tag === 1) ||\n      (selfCollider.tag === 1 && otherCollider.tag === 0)\n    ) {\n      selfCollider.tag === 0\n        ? selfCollider.getComponent(BulletCtrl).miss()\n        : selfCollider.getComponent(EnemyCtrl).die();\n      otherCollider.tag === 1\n        ? otherCollider.getComponent(EnemyCtrl).die()\n        : otherCollider.getComponent(BulletCtrl).miss();\n    }\n\n    // 敌人和英雄碰撞\n    if (\n      (selfCollider.tag === 1 && otherCollider.tag === 2 && !selfCollider.getComponent(EnemyCtrl).isDestory) ||\n      (selfCollider.tag === 2 && otherCollider.tag === 1 && !otherCollider.getComponent(EnemyCtrl).isDestory)\n    ) {\n      find(\"Canvas/bg\").getComponent(BackgroundCtrl)?.pause();\n      selfCollider.tag === 1\n        ? selfCollider.getComponent(EnemyCtrl).vectory()\n        : otherCollider.getComponent(EnemyCtrl).vectory();\n      this.lose();\n    }\n  }\n\n  start(): void {\n    const uiTrans = this.node.getComponent(UITransform)!;\n    this.node.on(Node.EventType.TOUCH_MOVE, (touch: EventTouch) => {\n      this.node.setWorldPosition(\n        v3(touch.getUILocation().x, touch.getUILocation().y)\n      );\n    });\n\n    // 计时器\n    this.schedule(() => {\n      let aNumber: number = 175 * Math.random() + 1;\n      let xPos: number = Math.floor(aNumber);\n      let symbol: boolean = Math.random() > 0.5;\n      if (!symbol && xPos !== 0) {\n        xPos = -xPos;\n      }\n\n      let enemy: Node = instantiate(this.enemyPrefab);\n      enemy.setParent(this.node.parent);\n      enemy.setPosition(xPos, 420);\n    }, 0.5);\n\n    // 计时器\n    this.schedule(() => {\n      let bullet: Node = instantiate(this.bulletPrefab);\n      bullet.setParent(this.node.parent);\n      bullet.setPosition(\n        this.node.getPosition().x,\n        this.node.getPosition().y + 80\n      );\n    }, 0.1);\n  }\n\n  update(deltaTime: number) {}\n\n  lose(): void {\n    // 暂停所有计时器\n    this.unscheduleAllCallbacks();\n    resources.load(\n      \"hero1_die/spriteFrame\",\n      SpriteFrame,\n      (err: Error, data: SpriteFrame) => {\n        if (!err) {\n          this.node.getComponent(Sprite).spriteFrame = data;\n        }\n      }\n    );\n  }\n\n  onDestroy(): void {\n    this.node.destroy();\n    // 暂停所有计时器\n    this.unscheduleAllCallbacks();\n  }\n}\n"]}